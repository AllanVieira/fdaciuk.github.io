<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8" />
  
  <title>Javascript - Criando um módulo Ajax com Promises - Parte 1 | Da2k Blog</title>
  <link rel="author" href="//plus.google.com/+FernandoDaciuk">
  
  <meta name="description" content="No artigo anterior, você viu como as Promises resolvem o problema de callback hell. Agora vamos ver na prática como criar nossas próprias Promises!">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Javascript - Criando um módulo Ajax com Promises - Parte 1"/>
  <meta property="og:site_name" content="Da2k Blog"/>

  
    <meta property="og:image" content="/uploads/2015/03/ajax-module-with-promises.png" />
  

  <meta property="og:url" content="http://blog.da2k.com.br/2015/03/06/javascript-criando-um-modulo-ajax-com-promises/" />

  
    <meta name="google-site-verification" content="GDAVmZEJwsAq3Cv0Uk8BJNicEJCOkmYOqFxQKtR8RAw" />
  

  <link href="http://blog.da2k.com.br/favicon.png" rel="shortcut icon">
  <link rel="alternate" href="/atom.xml" title="Da2k Blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-26050978-1']);
  _gaq.push(['_setDomainName', 'da2k.com.br']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1>
    <a class="brand" href="/">
        
          <img src="/images/logo-blog.svg" width="210" height="80" title="Da2k Blog" />
        
    </a>
  </h1>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/cursos">Cursos</a></li>
    
      <li><a href="/atom.xml">RSS</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>

<a href="http://leokz.com/campanha/" target="_blank" class="banner-leokz">Ajude o Leonardo a vencer o câncer.</a>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-03-06T03:00:00.000Z"><a href="/2015/03/06/javascript-criando-um-modulo-ajax-com-promises/">6 de março de 2015</a></time>
      
      
  
    <h1 class="title">Javascript - Criando um módulo Ajax com Promises - Parte 1</h1>
  

    </header>
    <div class="entry">
      
        <p><img src="/uploads/2015/03/ajax-module-with-promises.png" alt=""></p>
<p>No <a href="http://blog.da2k.com.br/2015/03/05/javascript-entendendo-e-criando-suas-proprias-promises/" target="_blank" rel="external">artigo anterior</a>, você viu como as <strong>Promises</strong> resolvem o problema de <em>callback hell</em>. Agora vamos ver na prática como criar nossas próprias <strong>Promises</strong>!</p>
<a id="more"></a>

<h2 id="O_que_iremos_fazer?">O que iremos fazer?</h2>
<p>Nosso desafio é criar um módulo para usar <strong>Ajax</strong>, sem qualquer <em>library</em> ou <em>framework</em>, e que possamos obter os resultados das requisições via <strong>Promises</strong>.</p>
<p>O nosso módulo será feito usando a técnica de <a href="http://blog.da2k.com.br/2015/01/06/pensando-tdd-com-javascript/" target="_blank" rel="external">TDD</a>, ou seja, primeiro criamos um teste com o resultado esperado, e então partimos para o código em si :)</p>
<p>E o nosso primeiro passo é criar a estrutura do nosso projeto!</p>
<blockquote>
<p>Você pode acompanhar o andamento desse módulo através <a href="https://github.com/fdaciuk/ajax" target="_blank" rel="external">desse repositório no Github</a> :D</p>
</blockquote>
<h2 id="O_que_dá_pra_fazer_com_Ajax?">O que dá pra fazer com Ajax?</h2>
<p>Acho que o exemplo mais comum é o <a href="https://www.facebook.com/photo.php?fbid=437375279637294&amp;set=pb.100000944779095.-2207520000.1425703771.&amp;type=3&amp;theater" target="_blank" rel="external">carrinho de compras com Ajax.</a></p>
<h2 id="Estrutura_do_projeto">Estrutura do projeto</h2>
<p>Execute o comando abaixo no seu terminal, em um diretório separado para o projeto:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mkdir src tests && touch .editorconfig .jshintrc .gitignore gulpfile.js index.html src/ajax.js tests/test.ajax.js && <span class="built_in">echo</span> <span class="string">"{}"</span> &gt; package.json</div></pre></td></tr></table></figure>

<p>Isso irá gerar a seguinte estrutura:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">.</div><div class="line">├── .editorconfig</div><div class="line">├── .gitignore</div><div class="line">├── .jshintrc</div><div class="line">├── gulpfile.js</div><div class="line">├── package.json</div><div class="line">├── src</div><div class="line">│   └── ajax.js</div><div class="line">└── tests</div><div class="line">    └── ajaxTest.js</div></pre></td></tr></table></figure>

<p>Com nosso projeto criado, vamos montar nosso ambiente de testes :D</p>
<h2 id="Montando_o_ambiente_de_testes">Montando o ambiente de testes</h2>
<p>Se você ainda não está habituado com testes, ou nunca escreveu um, ou ainda não sabe para o que realmente eles servem, é muito importante que você leia <a href="http://blog.da2k.com.br/2015/01/06/pensando-tdd-com-javascript/" target="_blank" rel="external">esse artigo</a> antes de continuar :D</p>
<div class="ads-da2k"><a href="http://www.eventick.com.br/curso-javascript-ninja" target="_blank"><img src="https://cloud.githubusercontent.com/assets/487669/6239059/58b94ab0-b6e7-11e4-8e5d-a5f2740870fd.png" alt="CURSO NINJA JAVASCRIPT - INSCREVA-SE JÁ!"></a></div>

<p>Vamos instalar os módulos do <strong>Gulp</strong> necessários para que possamos fazer os testes no nosso módulo:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i --save-dev gulp gulp-mocha gulp-istanbul gulp-load-plugins chai</div></pre></td></tr></table></figure>

<h2 id="Configurações_dos_arquivos">Configurações dos arquivos</h2>
<p>Nosso arquivo <code>.jshintrc</code> ficará assim:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">{</div><div class="line">  "<span class="attribute">curly</span>"   : <span class="value"><span class="literal">true</span></span>,</div><div class="line">  "<span class="attribute">eqeqeq</span>"  : <span class="value"><span class="literal">true</span></span>,</div><div class="line">  "<span class="attribute">immed</span>"   : <span class="value"><span class="literal">true</span></span>,</div><div class="line">  "<span class="attribute">latedef</span>" : <span class="value"><span class="literal">true</span></span>,</div><div class="line">  "<span class="attribute">newcap</span>"  : <span class="value"><span class="literal">true</span></span>,</div><div class="line">  "<span class="attribute">noarg</span>"   : <span class="value"><span class="literal">true</span></span>,</div><div class="line">  "<span class="attribute">sub</span>"     : <span class="value"><span class="literal">true</span></span>,</div><div class="line">  "<span class="attribute">undef</span>"   : <span class="value"><span class="literal">true</span></span>,</div><div class="line">  "<span class="attribute">boss</span>"    : <span class="value"><span class="literal">true</span></span>,</div><div class="line">  "<span class="attribute">eqnull</span>"  : <span class="value"><span class="literal">true</span></span>,</div><div class="line">  "<span class="attribute">node</span>"    : <span class="value"><span class="literal">true</span></span>,</div><div class="line">  "<span class="attribute">globals</span>" : <span class="value">{</span></div><div class="line">    "<span class="attribute">document</span>" : <span class="value"><span class="literal">true</span></span>,</div><div class="line">    "<span class="attribute">window</span>"   : <span class="value"><span class="literal">true</span></span></div><div class="line">  }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>Já o <code>.editorconfig</code> terá a seguinte configuração:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="setting">root = <span class="value"><span class="keyword">true</span></span></span></div><div class="line">  </div><div class="line"><span class="title">[*]</span></div><div class="line"><span class="setting">charset = <span class="value">utf-<span class="number">8</span></span></span></div><div class="line"><span class="setting">end_of_line = <span class="value">lf</span></span></div><div class="line"><span class="setting">insert_final_newline = <span class="value"><span class="keyword">false</span></span></span></div><div class="line"><span class="setting">indent_style = <span class="value">space</span></span></div><div class="line"><span class="setting">indent_size = <span class="value"><span class="number">2</span></span></span></div><div class="line"><span class="setting">trim_trailing_whitespace = <span class="value"><span class="keyword">true</span></span></span></div><div class="line">  </div><div class="line"><span class="title">[*.md]</span></div><div class="line"><span class="setting">trim_trailing_whitespace = <span class="value"><span class="keyword">false</span></span></span></div></pre></td></tr></table></figure>

<p>E o <code>.gitignore</code>:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">node_modules/</div></pre></td></tr></table></figure>

<p>E agora vamos configurar nosso <code>gulpfile.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="pi">'use strict'</span>;</div><div class="line">  </div><div class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>( <span class="string">'gulp'</span> );</div><div class="line"><span class="keyword">var</span> g = <span class="built_in">require</span>( <span class="string">'gulp-load-plugins'</span> )();</div><div class="line">  </div><div class="line"><span class="keyword">var</span> allTestFiles = <span class="string">'./tests/**/*.js'</span>;</div><div class="line">  </div><div class="line">gulp.task( <span class="string">'assets'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">  gulp.src([</div><div class="line">    <span class="string">'node_modules/gulp-mocha/node_modules/mocha/mocha.{js,css}'</span>,</div><div class="line">    <span class="string">'node_modules/chai/chai.js'</span></div><div class="line">  ])</div><div class="line">  .pipe( gulp.dest( <span class="string">'public'</span> ) );</div><div class="line">});</div><div class="line">  </div><div class="line">gulp.task( <span class="string">'mocha'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">  gulp.src([ allTestFiles ], { read : <span class="literal">false</span> })</div><div class="line">  .pipe(</div><div class="line">    g.mocha({ reporter: <span class="string">'list'</span> })</div><div class="line">  );</div><div class="line">});</div><div class="line">  </div><div class="line">gulp.task( <span class="string">'test'</span>, <span class="function"><span class="keyword">function</span><span class="params">( done )</span> </span>{</div><div class="line">  gulp.src([ allTestFiles ])</div><div class="line">    .pipe( g.istanbul() )</div><div class="line">    .on( <span class="string">'finish'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">      gulp.src([ allTestFiles ])</div><div class="line">      .pipe( g.mocha() )</div><div class="line">      .on( <span class="string">'error'</span>, done )</div><div class="line">      .pipe( g.istanbul.writeReports() )</div><div class="line">      .on( <span class="string">'end'</span>, done );</div><div class="line">    });</div><div class="line">});</div><div class="line">  </div><div class="line">gulp.task( <span class="string">'default'</span>, [ <span class="string">'assets'</span> ], <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">  gulp.watch([ allTestFiles, <span class="string">'src/ajax.js'</span> ], [ <span class="string">'test'</span> ]);</div><div class="line">});</div></pre></td></tr></table></figure>

<p>E Enfim, nosso ‘index.html’: </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="doctype">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"utf-8"</span> /&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">title</span>&gt;</span>Ajax module in VanillaJS<span class="tag">&lt;/<span class="title">title</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> <span class="attribute">href</span>=<span class="value">"public/mocha.css"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"mocha"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"src/ajax.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"public/chai.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"public/mocha.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">mocha.setup(<span class="string">'bdd'</span>)</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"tests/test.ajax.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">mocha.run()</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></div></pre></td></tr></table></figure>

<p>Acessando essa <code>index.html</code> no seu navegador, você terá acesso à todos os testes, podendo acompanhá-los à medida em que forem sendo implementados :)</p>
<h2 id="Detalhes_do_método">Detalhes do método</h2>
<p>Antes de darmos início, nós precisamos definir o que precisa ser implementado no nosso módulo. Nessa etapa, não vamos definir código, mas sim como ele deve funcionar.</p>
<p>Basicamente, nós queremos que nosso módulo utilize Ajax (<a href="https://developer.mozilla.org/pt-BR/docs/Web/API/XMLHttpRequest" target="_blank" rel="external">XMLHttpRequest</a>), e que ele responda aos métodos <code>get</code>, <code>post</code>, <code>put</code> e <code>delete</code>.</p>
<p>A resposta deve vir no formato de <strong>Promises</strong>, com os métodos <code>done</code> e <code>error</code>.</p>
<p>Esse será nosso <a href="http://pt.wikipedia.org/wiki/Produto_vi%C3%A1vel_m%C3%ADnimo" target="_blank" rel="external">MVP</a>.</p>
<p>Já pode colocar o <strong>Gulp</strong> pra rodar e ficar assistindo nossos arquivos, com o comando:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gulp</div></pre></td></tr></table></figure>

<h2 id="Usando_o_padrão_UMD">Usando o padrão UMD</h2>
<p>Para que nosso módulo funcione corretamente com CommonJS, AMD ou sem nenhum padrão de módulos específico, precisamos usar o formato <a href="http://blog.da2k.com.br/2015/01/05/como-criar-componentes-js-usando-modulos-amd-commonjs-e-umd-parte-3-3/" target="_blank" rel="external"><strong>UMD</strong></a>.</p>
<p>Nosso módulo <code>src/ajax.js</code> iniciará com a seguinte estrutura:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">;(<span class="function"><span class="keyword">function</span> <span class="params">( root, factory )</span> </span>{</div><div class="line"><span class="pi">  'use strict'</span>;</div><div class="line">  <span class="comment">/* istanbul ignore next */</span></div><div class="line">  <span class="keyword">if</span> ( <span class="keyword">typeof</span> define === <span class="string">'function'</span> && define.amd ) {</div><div class="line">    define( <span class="string">'Ajax'</span>, factory );</div><div class="line">  }</div><div class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="keyword">typeof</span> exports === <span class="string">'object'</span> ) {</div><div class="line">    exports = <span class="built_in">module</span>.exports = factory();</div><div class="line">  }</div><div class="line">  <span class="keyword">else</span> {</div><div class="line">    root.Ajax = factory();</div><div class="line">  }</div><div class="line">})(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line"><span class="pi">  'use strict'</span>;</div><div class="line">  </div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">Ajax</span><span class="params">()</span> </span>{</div><div class="line">    <span class="keyword">var</span> $public = {};</div><div class="line">    <span class="keyword">var</span> $private = {};</div><div class="line">  </div><div class="line">    <span class="keyword">return</span> $public;</div><div class="line">  }</div><div class="line">  </div><div class="line">  <span class="keyword">return</span> Ajax;</div><div class="line">});</div></pre></td></tr></table></figure>

<p>Das linhas <code>1</code> a <code>13</code>, aplicamos o <strong>UMD</strong>. Agora nosso módulo é Universal :D</p>
<p>O comentário na linha <code>3</code>, é para que o <strong>Istanbul</strong> ignore esse <code>if</code>, pois não teremos os <code>3</code> módulos juntos (AMD, CommonJS e sem nenhum), será somente um desses, então não temos como fazer com que toda essa parte seja coberta por testes. Logo, podemos ignorá-la.</p>
<p><strong>Observação importante:</strong> </p>
<p>Se você tentar incluir esse módulo em qualquer um dos 3 formatos citados acima, vai ver que ele vai funcionar. Quando você não consegue dar cobertura a um código, como é o caso do <strong>UMD</strong>, você precisa, ao menos, garantir manualmente que tudo funciona. Não adianta comentar todo o código para que o <em>Istanbul</em> ignore, pois você estará enganando a si mesmo. Use essa feature com cautela.</p>
<h2 id="Iniciando_os_testes">Iniciando os testes</h2>
<p>Agora sim estamos prontos para começar a codar! Nossa primeira asserção irá testar a interface do nosso módulo. Precisamos garantir que nosso módulo tenha os métodos <code>get</code>, <code>post</code>, <code>put</code> e <code>delete</code>.</p>
<p>Vamos então criar o teste para isso. A base do nosso arquivo <code>tests/test.ajax.js</code> ficará assim:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">;(<span class="function"><span class="keyword">function</span> <span class="params">( root, factory )</span> </span>{</div><div class="line"><span class="pi">  'use strict'</span>;</div><div class="line">  </div><div class="line">  <span class="keyword">if</span> ( <span class="keyword">typeof</span> define === <span class="string">'function'</span> && define.amd ) {</div><div class="line">    define( <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">      <span class="built_in">require</span>([ <span class="string">'Ajax'</span> ]);</div><div class="line">    });</div><div class="line">  }</div><div class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="keyword">typeof</span> exports === <span class="string">'object'</span> ) {</div><div class="line">    exports = <span class="built_in">module</span>.exports = factory( <span class="built_in">require</span>( <span class="string">'chai'</span> ).should(), <span class="built_in">require</span>( <span class="string">'../src/ajax'</span> ) );</div><div class="line">  }</div><div class="line">  <span class="keyword">else</span> {</div><div class="line">    root.Ajax = factory( root.chai.should(), root.Ajax );</div><div class="line">  }</div><div class="line">})(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span><span class="params">( should, Ajax )</span> </span>{</div><div class="line"><span class="pi">  'use strict'</span>;</div><div class="line">  </div><div class="line">  describe( <span class="string">'Test module interface'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">    it( <span class="string">'Should have `get` method'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">      <span class="keyword">var</span> ajax = <span class="keyword">new</span> Ajax();</div><div class="line">      ajax.should.have.property( <span class="string">'get'</span> );</div><div class="line">    });</div><div class="line">  });</div><div class="line">});</div></pre></td></tr></table></figure>

<p>Vamos adicionar o <strong>UMD</strong> também para o nosso teste, pois ele ficará rodando no terminal, com <strong>Node</strong>. Assim nós poderemos acompanhar os resultados tanto no browser, como no terminal :)</p>
<p>Incluímos a biblioteca <a href="http://chaijs.com/" target="_blank" rel="external">Chai</a>, para fazer as asserções dos nossos testes.</p>
<p>Na linha <code>18</code>, damos início ao teste:</p>
<p>O <code>describe</code> vai criar um <code>wrapper</code> com vários testes de uma parte específica do módulo. Nesse primeiro <code>describe</code>, vamos testar a <em>interface</em> do módulo.</p>
<p>Nosso primeiro teste, na linha <code>19</code>, diz que nosso módulo “Deveria ter um método chamado <strong>get</strong>“.</p>
<p>Instanciamos o objeto do nosso módulo - <code>new Ajax()</code> - e fazemos a asserção, verificando se a propriedade <code>get</code> existe.</p>
<p>E o nosso teste quebra, pois esse método não existe:</p>
<p><img src="/uploads/2015/03/method-get-doesnt-exist.png" alt=""></p>
<p>E esse é exatamente o comportamento esperado, pois ainda não temos código no nosso módulo que o faça funcionar! Esse é o primeiro passo do TDD: O <span style="color: red">RED</span>.</p>
<p>Agora, você lembra qual o próximo passo? Após nosso teste quebrar, pois adicionamos um teste para verificar algo que ainda não existe, vamos tentar fazer o teste passar, com o mínimo de código possível (<em>baby steps</em>):</p>
<p>Adicionamos então ao nosso arquivo <code>src/ajax.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"><span class="keyword">var</span> $public = {};</div><div class="line">  </div><div class="line">$public.get = <span class="function"><span class="keyword">function</span> <span class="title">get</span><span class="params">()</span> </span>{};</div><div class="line">...</div></pre></td></tr></table></figure>

<p>Pronto, agora temos um método <code>get</code>! Vamos ver se nosso teste passou?</p>
<p><img src="/uploads/2015/03/method-get-pass.png" alt=""></p>
<p>Agora sim! Temos o <span style="color: green">GREEN</span>, pois nosso teste passou. </p>
<p>Podemos ainda acompanhar no terminal como está a cobertura do nosso código:</p>
<p><img src="/uploads/2015/03/code-coverage-ajax-module.jpg" alt=""></p>
<p>Como estamos usando TDD, a tendência é que tenhamos sempre 100% do nosso código coberto por testes! :D</p>
<p>O próximo passo é o <span style="color: blue">BLUE</span>, ou <strong>Refactory</strong>. Nesse caso, não precisamos refatorar nosso código, pois não tem nada a ser refatorado.</p>
<p>Com o passar dos testes, dependendo do <em>baby step</em> que nós utilizarmos, precisaremos refatorar o código para que ele se mantenha em ordem. O passo do <em>refactory</em> serve somente para limpar o código já existente. Você nunca deve incluir nenhuma funcionalidade a mais no momento do <em>refactory</em>. Os testes que passam devem continuar passando, mas a leitura do código deve ser melhor do que você deixou da última vez :)</p>
<p>Curioso para ver como isso continua? Então aguarde o <a href="http://blog.da2k.com.br/2015/03/08/javascript-criando-um-modulo-ajax-com-promises-parte-2/" target="_blank" rel="external">próximo post</a>! :D</p>
<p>Fica como lição de casa pra você fazer os outros 3 testes com os métodos <code>post</code>, <code>put</code> e <code>delete</code>!</p>
<p>Nos próximos artigos, vamos continuar criando nosso módulo, até que ele resolva nosso primeiro objetivo: ter os 4 métodos e responder com as <strong>Promises</strong>.</p>
<p>Ficou com dúvidas? Comentae!</p>
<p>Até lá!</p>
<blockquote>
<p>Sobre o #1postperday: <a href="http://blog.da2k.com.br/2014/12/31/um-post-por-dia/" target="_blank" rel="external">http://blog.da2k.com.br/2014/12/31/um-post-por-dia/</a></p>
<p>Tem alguma sugestão para os próximos posts do #1postperday? Deixe ela aqui: <a href="https://github.com/fdaciuk/fdaciuk.github.io/issues/1" target="_blank" rel="external">https://github.com/fdaciuk/fdaciuk.github.io/issues/1</a></p>
</blockquote>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/javascript/">javascript</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/1postperday/">1postperday</a>, <a href="/tags/promises/">promises</a>, <a href="/tags/ajax/">ajax</a>
  </div>

        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count" addthis:url="http://blog.da2k.com.br/2015/03/06/javascript-criando-um-modulo-ajax-com-promises/"></a>
    
    
      <a class="addthis_button_tweet" addthis:url="http://blog.da2k.com.br/2015/03/06/javascript-criando-um-modulo-ajax-com-promises/"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium" addthis:url="http://blog.da2k.com.br/2015/03/06/javascript-criando-um-modulo-ajax-com-promises/"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal" addthis:url="http://blog.da2k.com.br/2015/03/06/javascript-criando-um-modulo-ajax-com-promises/"></a>
    
    <a class="addthis_counter addthis_pill_style" addthis:url="http://blog.da2k.com.br/2015/03/06/javascript-criando-um-modulo-ajax-com-promises/"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>


      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>

<div class="newsletter">
  <h3 class="newsletter-title">Não perca nenhuma atualização!</h3>
  <p class="newsletter-description"><em>Não vou mandar SPAM, não se preocupe ;)</em></p>

  <form action="//da2k.us6.list-manage.com/subscribe/post?u=56a51839b0a1d33544ef8745a&amp;id=41446ab989" method="post" target="_blank" data-js="form-newsletter" class="newsletter__form">
    <input type="text" name="FNAME" id="signup-name" placeholder="Nome" class="[ input-text ] newsletter__form__input" />
    <input type="email" name="EMAIL" id="signup-email" placeholder="E-mail" class="[ input-text ] newsletter__form__input" />
    <input type="text" name="b_56a51839b0a1d33544ef8745a_41446ab989" id="signup-email-robot" class="input-robot" />
    <button
      type="submit"
      data-js="button-submit"
      data-loading-text="Enviando..."
      data-original-text="OK"
      class="newsletter__form__button">
      Assinar!
    </button>
  </form>
</div>




<section id="comment">
  <h1 class="title">Comments</h1>

  
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
  
</section>


</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action=""
    method="get"
    data-action="https://google.com.br/search?q=site:blog.da2k.com.br"
    accept-charset="utf-8"
    data-js="google-search-form">
    <input type="search" name="q" results="0" placeholder="Search" data-js="google-search-input">
  </form>
</div>


  
<div class="widget tag">
  <h3 class="title">Categories</h3>
  <ul class="entry">
  
    <li><a href="/categories/css/">css</a><small>5</small></li>
  
    <li><a href="/categories/frontend/">frontend</a><small>1</small></li>
  
    <li><a href="/categories/git/">git</a><small>1</small></li>
  
    <li><a href="/categories/github/">github</a><small>13</small></li>
  
    <li><a href="/categories/html/">html</a><small>2</small></li>
  
    <li><a href="/categories/javascript/">javascript</a><small>37</small></li>
  
    <li><a href="/categories/markdown/">markdown</a><small>1</small></li>
  
    <li><a href="/categories/wordpress/">wordpress</a><small>13</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/1postperday/">1postperday</a><small>70</small></li>
  
    <li><a href="/tags/ajax/">ajax</a><small>5</small></li>
  
    <li><a href="/tags/amd/">amd</a><small>2</small></li>
  
    <li><a href="/tags/bdd/">bdd</a><small>1</small></li>
  
    <li><a href="/tags/braches/">braches</a><small>1</small></li>
  
    <li><a href="/tags/chrome-extension/">chrome extension</a><small>1</small></li>
  
    <li><a href="/tags/clean-code/">clean code</a><small>2</small></li>
  
    <li><a href="/tags/cli/">cli</a><small>1</small></li>
  
    <li><a href="/tags/code-coverage/">code coverage</a><small>1</small></li>
  
    <li><a href="/tags/commonjs/">commonjs</a><small>1</small></li>
  
    <li><a href="/tags/coverage/">coverage</a><small>1</small></li>
  
    <li><a href="/tags/debug/">debug</a><small>1</small></li>
  
    <li><a href="/tags/debugger/">debugger</a><small>1</small></li>
  
    <li><a href="/tags/deploy/">deploy</a><small>1</small></li>
  
    <li><a href="/tags/devtools/">devtools</a><small>1</small></li>
  
    <li><a href="/tags/disqus/">disqus</a><small>1</small></li>
  
    <li><a href="/tags/escalabilidade/">escalabilidade</a><small>1</small></li>
  
    <li><a href="/tags/formularios/">formularios</a><small>1</small></li>
  
    <li><a href="/tags/functional-programming/">functional programming</a><small>3</small></li>
  
    <li><a href="/tags/funcoes/">funções</a><small>1</small></li>
  
    <li><a href="/tags/getmodule/">getmodule</a><small>1</small></li>
  
    <li><a href="/tags/git/">git</a><small>1</small></li>
  
    <li><a href="/tags/github/">github</a><small>1</small></li>
  
    <li><a href="/tags/gulpjs/">gulpjs</a><small>5</small></li>
  
    <li><a href="/tags/hexo/">hexo</a><small>1</small></li>
  
    <li><a href="/tags/html5/">html5</a><small>1</small></li>
  
    <li><a href="/tags/istanbul/">istanbul</a><small>1</small></li>
  
    <li><a href="/tags/linux/">linux</a><small>1</small></li>
  
    <li><a href="/tags/markdown/">markdown</a><small>2</small></li>
  
    <li><a href="/tags/module-pattern/">module pattern</a><small>1</small></li>
  
    <li><a href="/tags/mutation-observer/">mutation observer</a><small>1</small></li>
  
    <li><a href="/tags/mvc/">mvc</a><small>1</small></li>
  
    <li><a href="/tags/nodejs/">nodejs</a><small>7</small></li>
  
    <li><a href="/tags/performance/">performance</a><small>1</small></li>
  
    <li><a href="/tags/promises/">promises</a><small>6</small></li>
  
    <li><a href="/tags/pre-processadores/">pré-processadores</a><small>4</small></li>
  
    <li><a href="/tags/recursao/">recursão</a><small>1</small></li>
  
    <li><a href="/tags/requirejs/">requirejs</a><small>1</small></li>
  
    <li><a href="/tags/rsync/">rsync</a><small>1</small></li>
  
    <li><a href="/tags/segredos-do-github/">segredos do github</a><small>12</small></li>
  
    <li><a href="/tags/serie-temas-wordpress/">serie temas wordpress</a><small>11</small></li>
  
    <li><a href="/tags/setinterval/">setInterval</a><small>1</small></li>
  
    <li><a href="/tags/settimeout/">setTimeout</a><small>1</small></li>
  
    <li><a href="/tags/sourcemaps/">sourcemaps</a><small>1</small></li>
  
    <li><a href="/tags/spam/">spam</a><small>1</small></li>
  
    <li><a href="/tags/ssh/">ssh</a><small>1</small></li>
  
    <li><a href="/tags/stylus/">stylus</a><small>4</small></li>
  
    <li><a href="/tags/task-runner/">task runner</a><small>1</small></li>
  
    <li><a href="/tags/tdd/">tdd</a><small>2</small></li>
  
    <li><a href="/tags/tema-wordpress/">tema wordpress</a><small>1</small></li>
  
    <li><a href="/tags/temporizadores/">temporizadores</a><small>1</small></li>
  
    <li><a href="/tags/tips/">tips</a><small>5</small></li>
  
    <li><a href="/tags/umd/">umd</a><small>1</small></li>
  
    <li><a href="/tags/void/">void</a><small>1</small></li>
  
    <li><a href="/tags/wordcamp/">wordcamp</a><small>1</small></li>
  
    <li><a href="/tags/workflow/">workflow</a><small>3</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2015 <a href="//plus.google.com/+FernandoDaciuk?rel=author" rel="author"  target="_blank">Fernando Daciuk</a>
  
</div>
<div class="clearfix"></div>
</footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/google-search.js"></script>
<script src="/js/modules/InfiniteScroll.js"></script>
<script src="/js/app.js" id="script-main" data-url="http://blog.da2k.com.br/2015/03/06/javascript-criando-um-modulo-ajax-com-promises/"></script>


<script type="text/javascript">
var disqus_shortname = 'blogda2k';
var disqus_url = 'http://blog.da2k.com.br/2015/03/06/javascript-criando-um-modulo-ajax-com-promises/';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


</body>
</html>