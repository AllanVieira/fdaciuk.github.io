<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8" />
  
  <title>Criando uma ferramenta de CLI com NodeJS | Da2k Blog</title>
  <link rel="author" href="//plus.google.com/+FernandoDaciuk">
  
  <meta name="description" content="Ferramentas de linha de comando ajudam quando você precisa executar tarefas mais rapidamente. Que tal aprender a criar vocẽ mesmo a sua? E em NodeJS! E ainda disponibilizar no NPMJS! Ficou curioso? Vem que eu te mostro como faz ;)">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Criando uma ferramenta de CLI com NodeJS"/>
  <meta property="og:site_name" content="Da2k Blog"/>

  
    <meta property="og:image" content="http://blog.da2k.com.br/uploads/2015/03/nodejs-cli.png" />
  

  <meta property="og:url" content="http://blog.da2k.com.br/2015/03/20/criando-uma-ferramenta-de-cli-com-nodejs/" />

  
    <meta name="google-site-verification" content="GDAVmZEJwsAq3Cv0Uk8BJNicEJCOkmYOqFxQKtR8RAw" />
  

  <link href="http://blog.da2k.com.br/favicon.png" rel="shortcut icon">
  <link rel="alternate" href="/atom.xml" title="Da2k Blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-26050978-1']);
  _gaq.push(['_setDomainName', 'da2k.com.br']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1>
    <a class="brand" href="/">
        
          <img src="/images/logo-blog.svg" width="210" height="80" title="Da2k Blog" />
        
    </a>
  </h1>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/cursos">Cursos</a></li>
    
      <li><a href="/atom.xml">RSS</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>

<a href="http://leokz.com/campanha/" target="_blank" class="banner-leokz">Ajude o Leonardo a vencer o câncer.</a>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-03-20T03:00:00.000Z"><a href="/2015/03/20/criando-uma-ferramenta-de-cli-com-nodejs/">20 de março de 2015</a></time>
      
      
  
    <h1 class="title">Criando uma ferramenta de CLI com NodeJS</h1>
  

    </header>
    <div class="entry">
      
        <p><img src="http://blog.da2k.com.br/uploads/2015/03/nodejs-cli.png" alt=""></p>
<p>Ferramentas de linha de comando ajudam quando você precisa executar tarefas mais rapidamente. Que tal aprender a criar vocẽ mesmo a sua? E em <strong>NodeJS</strong>! E ainda disponibilizar no <strong>NPMJS</strong>! Ficou curioso? Vem que eu te mostro como faz ;)</p>
<a id="more"></a>

<h2 id="O_que_é_uma_CLI?">O que é uma CLI?</h2>
<p><strong>CLI</strong> significa <em>Command Line Interface</em>, ou seja, é uma ferramenta que disponibiliza uma interface de linha de comando para que você possa executar alguns comandos específicos no terminal. Normalmente essas ferramentas são criadas utilizando <em>shell script</em>, mas nós vamos criar a nossa com Javascript :D</p>
<p><em>Antes de começar, que tal mostrar alguns exemplos de <strong>CLI</strong></em>?</p>
<p><a href="http://gulpjs.com/" target="_blank" rel="external"><strong>Gulp</strong></a>, <a href="http://gruntjs.com/" target="_blank" rel="external"><strong>Grunt</strong></a>, <a href="http://expressjs.com/" target="_blank" rel="external"><strong>Express</strong></a>, <a href="http://mochajs.org/" target="_blank" rel="external"><strong>Mocha</strong></a>, e inclusive o próprio <a href="https://nodejs.org/" target="_blank" rel="external"><strong>NodeJS</strong></a> e <a href="https://www.npmjs.com/" target="_blank" rel="external"><strong>NPM</strong></a> são ótimos exemplos de <strong>CLI</strong>. Essas ferramentas de <strong>CLI</strong> criadas em <strong>NodeJS</strong> normalmente estão disponíveis para baixar no <a href="https://www.npmjs.com/" target="_blank" rel="external">https://www.npmjs.com/</a>, onde vocẽ instala com o comando <code>npm i -g nome-da-ferramenta</code>.</p>
<p>Quando você instala um módulo do <strong>Node</strong> globalmente, usando o <code>-g</code>, é porque essa ferramenta normalmente disponibiliza essa interface de linha de comando, onde você não precisa depender do comando <code>node nome-da-ferramenta</code> para executá-la, e sim poder usar o próprio nome da ferramenta como comando.</p>
<p>Por exemplo: como você faz para executar uma tarefa do <strong>Gulp</strong>? Você executa <code>gulp nome-da-task</code>, sem precisar do comando <code>node</code>! Isso é uma <strong>CLI</strong> :D</p>
<h2 id="Como_faz_então?">Como faz então?</h2>
<p>Vamos criar uma ferramenta bastante simples: uma calculadora que faz a soma entre dois números passados como parâmetro. A primeira coisa é escolher um nome para a ferramenta, - <em>vixxxxxx</em> - pois esse nome precisa estar disponível no NPMJS :)</p>
<p>Acho que essa é a parte mais difícil, haha :D</p>
<p>Não conheço nenhuma ferramenta que verifique se um nome está disponível no NPMJS - inclusive, isso seria uma ideia bem útil de CLI ;) - então vamos verificar manualmente se tem algum nome disponível, chutando mesmo:</p>
<p>Acesse <a href="https://www.npmjs.com/package/" target="_blank" rel="external">https://www.npmjs.com/package/</a>, e coloque um nome após a barra. Se ele estiver disponível, você verá uma página de <code>not found</code> :)</p>
<p>Nossa <strong>CLI</strong> se chamará <code>calculatr</code>, e será usada da seguinte forma: usaremos no terminal o comando para somar dois números:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">calculatr sum <span class="number">2</span> <span class="number">3</span></div></pre></td></tr></table></figure>

<p>Que nos dará o resultado <code>5</code>! Bem inútil, mas vai servir para você ver como funciona uma <strong>CLI</strong> :D</p>
<p><strong>Observação:</strong> existem muitos pacotes no NPMJS, alguns indispensáveis, outros bastante inúteis. Então lembre-se que você sempre terá a opção de <strong>despublicar</strong> um pacote, se você estiver fazendo somente testes para ver como tudo funciona por lá. Assim nós ajudamos ao próximo e a nós mesmos, não deixando no NPMJS coisas desatualizadas e que não sirvam para nada ;)</p>
<p>Agora que sabemos como será a interface do nosso projeto, vamos ver como criar a ferramenta.</p>
<h2 id="Primeiros_passos">Primeiros passos</h2>
<p>O passo inicial é criar um diretório separado para o projeto. A estrutura será bastante simples: só precisaremos de um diretório chamado <code>calculatr/</code> e, dentro dele, um arquivo com qualquer nome. Vamos chamar de <code>calculatr.js</code> :)</p>
<p>Precisaremos também de um <code>package.json</code> com algumas informações para o nosso módulo.</p>
<p>Em artigos anteriores, mostrei que você poderia sempre criar o seu <code>package.json</code> com o comando <code>echo &quot;{}&quot; &gt; package.json</code>, que imprimiria dentro do arquivo somente um “abre e fecha chaves”, que é o mínimo que precisamos quando estamos usando o <strong>Node</strong> com um <em>task runner</em>, por exemplo, onde o <code>package.json</code> será usado somente para gerenciamento de pacotes.</p>
<p>Agora, nós vamos criar nosso próprio módulo <strong>NodeJS</strong>, então o <code>package.json</code> precisa de uma atenção especial :)</p>
<h2 id="Criando_o_package-json">Criando o <code>package.json</code></h2>
<p>Para criar o <code>package.json</code>, você pode usar o comando <code>npm init</code>, e então responder algumas perguntas para criar seu módulo. A primeira pergunta é sobre o nome do módulo. Por <em>default</em>, NPM vai te sugerir o nome do diretório atual, que normalmente é o nome do projeto. Vamos manter (se estive como <code>calculatr</code>).</p>
<p>A próxima pergunta é sobre a versão. Estamos começando agora, então vamos deixar com a versão <code>0.0.1</code>. Daqui a pouco vou explicar melhor sobre como funcionam as versões ;)</p>
<p>Por enquanto, digite <code>0.0.1</code> e dê enter.</p>
<p>Agora é pedido uma descrição sobre o projeto. Essa descrição aparecerá no site do NPMJS, então capriche ;)<br>Vamos deixar algo como:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CLI Calculator</div></pre></td></tr></table></figure>

<p>Depois, ele pede o <code>entrypoint</code>. Esse parâmetro referencia o arquivo principal, ou o ponto de entrada da nossa aplicação. No nosso caso, esse arquivo é o <code>calculatr.js</code>.</p>
<p>O próximo é <code>test command</code>. Esse será o comando que você irá utilizar para testar seu código. Vamos utilizar o comando:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">istanbul cover _mocha -- -R spec</div></pre></td></tr></table></figure>

<p>Utilizaremos o <a href="http://blog.da2k.com.br/2015/01/07/code-coverage-em-javascript/" target="_blank" rel="external"><code>istanbul</code> para coverage</a> e o <a href="http://blog.da2k.com.br/2015/01/06/pensando-tdd-com-javascript/" target="_blank" rel="external"><code>mocha</code> para os testes</a>. Lembre-se de ter esses dois pacotes instalados globalmente. Se não tiver, execute no seu terminal:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i -g istanbul mocha</div></pre></td></tr></table></figure>

<p>A próxima pergunta é sobre o repositório no Github. Se você ainda não criou o repositório para esse projeto, faça-o e entre com a URL. Se quiser fazer depois, não há problemas. Quando você configurar o <code>git</code> para esse projeto e rodar <code>npm init</code> novamente, o seu <code>package.json</code> será atualizado com essas informações :) </p>
<p>A licença, você pode escolher uma que esteja de acordo com o formato que vocẽ irá disponibilizar sua ferramenta. Normalmente usa-se <code>MIT</code>, ou <code>GPLv2</code>, <code>v3</code>. Se tiver dúvidas quanto à licença, pode escolher uma [por aqui] (<a href="http://choosealicense.com/" target="_blank" rel="external">http://choosealicense.com/</a>).</p>
<p>Se tudo der certo, vocẽ terá um <code>package.json</code> preenchido!</p>
<p>Mas, como estamos criando uma <strong>ferramenta de CLI</strong>, precisamos adicionar mais algumas entradas. Edite seu <code>package.json</code>, e adicione:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">"preferGlobal": true,</div><div class="line">"bin": {</div><div class="line">  "calculatr": "calculatr.js"</div><div class="line">}</div></pre></td></tr></table></figure>

<p>No site do NPMJS, é mostrado o comando de instalação do módulo. O <code>preferGlobal</code> diz ao NPM que esse módulo deve ser instalado globalmente. Logo, no site do NPMJS irá aparecer o seguinte comando para instalação do móulo:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install -g calculatr</div></pre></td></tr></table></figure>

<p>E o parâmetro <code>bin</code>, é para que possamos dizer ao NPM que, quando executarmos <code>calculatr</code> no terminal, o arquivo que será chamado é o <code>calculatr.js</code>.</p>
<p>Adicione também mais uma entrada em <code>scripts</code>, no seu <code>package.json</code>. Ele deve ficar assim:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">"scripts": {</div><div class="line">  "test": "istanbul cover _mocha -- -R spec",</div><div class="line">  "watch": "istanbul cover _mocha -- -R spec --watch"</div><div class="line">},</div></pre></td></tr></table></figure>

<p>Para que possamos executar nossos testes sem precisar nos preocupar em ficar executando o comando <code>npm test</code> toda hora. Só precisaremos executar <code>npm run watch</code> e <em>voilà</em>!</p>
<p>E agora nosso <code>package.json</code> está pronto!</p>
<div class="ads-da2k"><a href="http://www.eventick.com.br/curso-javascript-ninja" target="_blank"><img src="https://cloud.githubusercontent.com/assets/487669/6239059/58b94ab0-b6e7-11e4-8e5d-a5f2740870fd.png" alt="CURSO NINJA JAVASCRIPT - INSCREVA-SE JÁ!"></a></div>

<h2 id="Sobre_Versões">Sobre Versões</h2>
<p>As versões para os módulos funcionam mais ou menos assim: o terceiro número se refere somente a ajustes, solução de bugs, mas sem adicionar novas funcionalidades. Quando temos um módulo com versão <code>0.0.x</code>, onde <code>x</code> você incrementa a cada alteração que vocẽ fizer no módulo, chamamos de versão <code>alpha</code>. O segundo número, é quando vocẽ tem uma versão de algo já funcional. Então, a versão <code>0.1.0</code> tem a primeira versão <code>beta</code>, ou seja, ainda em testes, mas com alguma funcionalidade pronta. O incremento do segundo número deve ser a cada nova funcionalidade. O terceiro número continua sendo para resolver bugs, ou pequenos problemas. Então, se vocẽ tiver uma versão <code>0.1.3</code>, significa que, na versão beta, que tem <code>1</code> funcionalidade que funciona (?), você já fez <code>3</code> correções de bugs, ou ajustes.</p>
<p>E o último número, é quando você tem uma versão estável do módulo, com o mínimo de funcionalidades que você considera ideal para que ele seja um módulo “completo”. Esse completo é muito relativo, mas, dando o exemplo do nosso módulo, quando ele estiver somando dois números, ele já estará estável, e poderemos usar a versão <code>1.0.0</code>. </p>
<p>Nem todos os módulos seguem essa ideia. Alguns tem sua própria forma de gerenciar suas versões, mas a base é mais ou menos essa.</p>
<h2 id="Criando_o_módulo">Criando o módulo</h2>
<p>Agora, vamos começar a criar nosso módulo! </p>
<p>Como boa prática, vamos primeiro aos testes :D</p>
<p>Crie um diretório <code>test</code>, e, dentro dele, um arquivo chamado <code>test.calculatr.js</code>. Antes de começar, vamos instalar as dependências que usaremos. Já temos o <code>istanbul</code>e o <code>mocha</code>, como citado anteriormente. Se não os tiver instalados globalmente ainda, instale.</p>
<p>Após isso, vamos às dependências para os testes:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i --save-dev should</div></pre></td></tr></table></figure>

<p>Instalamos com <a href="http://blog.da2k.com.br/2015/03/03/gerenciando-corretamente-dependencias-em-nodejs-save-ou-save-dev-1/" target="_blank" rel="external">—save-dev</a>, pois queremos o <code>should</code> somente para desenvolvimento, ele não fará parte da aplicação.</p>
<p>E então vamos escrever nosso primeiro teste. No arquivo <code>test/test.calculatr.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="pi">'use strict'</span>;</div><div class="line">  </div><div class="line"><span class="keyword">var</span> exec = <span class="built_in">require</span>( <span class="string">'child_process'</span> ).exec;</div><div class="line"><span class="keyword">var</span> pkg = <span class="built_in">require</span>( <span class="string">'../package.json'</span> );</div><div class="line"><span class="keyword">var</span> calculatr = <span class="string">'./calculatr.js'</span>;</div><div class="line"><span class="built_in">require</span>( <span class="string">'should'</span> );</div><div class="line">  </div><div class="line">describe( <span class="string">'Calculatr'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">  it( <span class="string">'Should return version of calculatr'</span>, <span class="function"><span class="keyword">function</span><span class="params">( done )</span> </span>{</div><div class="line">    exec( calculatr + <span class="string">' --version'</span>, <span class="function"><span class="keyword">function</span><span class="params">( err, stdout, stderr )</span> </span>{</div><div class="line">      <span class="keyword">if</span>( err ) <span class="keyword">throw</span> err;</div><div class="line">      stdout.replace( <span class="string">'\n'</span>, <span class="string">''</span> ).should.be.equal( pkg.version );</div><div class="line">      done();</div><div class="line">    });</div><div class="line">  });</div><div class="line">});</div></pre></td></tr></table></figure>

<p><em>Opa! Tem bastante coisa nova ae!</em></p>
<p>Sim, vou explicar tudo :D</p>
<p>O <code>require( &#39;child_process&#39; ).exec</code> faz parte do <strong>NodeJS</strong>. Ele vai nos ajudar a executar comandos no terminal, permitindo-nos usar uma função de callback para fazer nosso teste quando o comando for executado :)</p>
<p>Na linha <code>4</code>, adicionamos o nosso <code>package.json</code>, e já veremos o porquê!</p>
<p>Na linha <code>5</code>, vamos simular o comando para executar o <code>calculatr</code>, pois ainda não temos o módulo instalado globalmente. Mas quando ele for instalado, usando <code>calculatr</code> irá chamar o arquivo <code>calculatr.js</code> :)</p>
<p>Adicionamos o <code>should</code> para fazer os testes.</p>
<p>No primeiro teste, vamos verificar se nossa CLI retorna a versão correta. Se usarmos o comando <code>calculatr --version</code>, deveria retornar a versão. Na linha <code>10</code> você pode ver o teste sendo feito, usando o <code>exec</code> para dar o comando.</p>
<p>O que ele faz é bem simples: como primeiro parâmetro da função, passamos o comando <code>calculatr + &#39; --version&#39;</code>. A função de callback nos retorna, como primeiro parâmetro, um erro (se houver), depois a saída no terminal (<code>stdout</code>), ou algum erro para a saída (<code>stderr</code>).</p>
<p>O que iremos usar para testar é a saída (<code>stdout</code>). Fazemos o teste com o comando da linha <code>12</code>. Testamos se a saída - que retorna sempre uma quebra de linha no final, por isso o <code>replace</code> - é igual à versão do nosso projeto. Pegamos a versão diretamente do <code>package.json</code>, pois ela será atualizada constantemente. Se colocarmos manualmente, teremos que lembrar de alterar a cada versão lançada, para não quebrar nosso teste.</p>
<p>Usamos a função <code>done()</code>, que já vimos no artigo sobre <a href="http://blog.da2k.com.br/2015/03/05/javascript-entendendo-e-criando-suas-proprias-promises/" target="_blank" rel="external">como criar um módulo Ajax com Promises</a>, que serve para dizer à função <code>it()</code>, que é o nosso teste, que nossa asserção já foi feita, e ele pode verificar se passou ou não.</p>
<p>Obviamente, nosso teste quebra, pois ainda não temos nada no arquivo principal :)</p>
<p>Ainda antes de criar nosso módulo, você percebeu que no nosso teste não executamos o comando <code>node ./calculatr.js --version</code>, e sim <code>./calculatr.js --version</code>, sem o <code>node</code>?</p>
<p>Como essa é uma ferramenta de <strong>CLI</strong>, ela precisa ser executada sem o comando <code>node</code>, mas para isso, ela precisa de permissão de execução. Para dar essa permissão, execute no seu terminal, na raiz do projeto:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chmod +x calculatr.js</div></pre></td></tr></table></figure>

<p>Isso fará com que seja possível executar esse arquivo diretamente com o comando <code>./calculatr</code>! Mas ainda tem outro segredo que só vou contar quando escrevermos nosso módulo :P</p>
<p>Vamos fazê-lo agora! No arquivo <code>calculatr.js</code>, adicione:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env node</span></div><div class="line"><span class="string">'use strict'</span>;</div><div class="line">  </div><div class="line">var program = require( <span class="string">'commander'</span> );</div><div class="line">var pkg = require( <span class="string">'./package.json'</span> );</div><div class="line">  </div><div class="line">program.version( pkg.version );</div><div class="line">program.parse( process.argv );</div></pre></td></tr></table></figure>

<p>A primeira linha é essencial para nossa <strong>CLI</strong>, pois é ela que faz a mágica para que nosso módulo funcione sem precisar escrever em <em>shell script</em>: dizemos que, ao chamar esse arquivo - executando <code>./calculatr</code> no terminal - , o programa que irá executá-lo será o <code>node</code>!</p>
<p>Então, por baixo dos panos, ao executarmos <code>./calculatr</code>, na verdade, o comando executado será <code>node ./calculatr</code> ;)</p>
<p><em>Safadeeeenho! Mas pera, tem um módulo novo ali! O que é esse <strong>commander</strong>?</em></p>
<p>O <code>commander</code> nos ajuda a montar uma interface para usarmos na linha de comando. Você deve instalá-lo com o comando:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i --save commander</div></pre></td></tr></table></figure>

<p>Agora usamos o <code>--save</code>, pois esse módulo será uma dependência do nosso projeto. Toda vez que o baixarmos, também será baixado o <code>commander</code> :)</p>
<p>Na linha <code>7</code>, passamos para o <code>commander</code> a versão do nosso projeto. Pegamos direto do <code>package.json</code>, como fizemos no arquivo de teste. E na linha <code>8</code>, fazemos o parse com os argumentos que forem passados no terminal. O <code>process.argv</code> recebe uma coleção com os argumentos passados. Ao fazer o parse, podemos executar o comando:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./calculatr.js --version</div></pre></td></tr></table></figure>

<p>Que retornará a versão da nossa ferramenta.</p>
<p>Agora, salvando o arquivo e olhando para o nosso teste, ele passou!! \o/</p>
<h2 id="Primeiro_método:_soma_(sum)">Primeiro método: soma (<code>sum</code>)</h2>
<p>Vamos fazer o primeiro método da nossa calculadora: a soma. Vamos receber, inicialmente, dois valores e somá-los.</p>
<p>E vamos usar o comando abaixo para efetuar a soma:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">calculatr sum <span class="number">1</span> <span class="number">2</span></div></pre></td></tr></table></figure>

<p>Que deverá imprimir o resultado <code>3</code>. Vamos fazer o teste? No arquivo <code>test/test.calculatr.js</code>, adicine mais um teste:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">it( <span class="string">'Command "calculatr sum 1 2" Should return 3'</span>, <span class="function"><span class="keyword">function</span><span class="params">( done )</span> </span>{</div><div class="line">  exec( calculatr + <span class="string">' sum 1 2'</span>, <span class="function"><span class="keyword">function</span><span class="params">( err, stdout, stderr )</span> </span>{</div><div class="line">    <span class="keyword">if</span>( err ) <span class="keyword">throw</span> err;</div><div class="line">    <span class="built_in">Number</span>( stdout ).should.be.equal( <span class="number">3</span> );</div><div class="line">    done();</div><div class="line">  });</div><div class="line">});</div></pre></td></tr></table></figure>

<p>O formato desse teste é bem parecido com o anterior. Só mudaremos o comando, que agora é <code>calculatr + &#39; sum 1 2 &#39;</code>, que deveria retornar <code>3</code>. O retorno da CLI é sempre uma string, então precisamos converter para número antes de fazer o teste, por isso usamos o objeto <code>Number</code> aqui, e então verificamos se o resultado é <code>3</code>.</p>
<p>E adivinha: o teste NÃO PASSA! A-ha! ¬¬</p>
<p>Agora vamos fazer a implementação do código. Vamos modificar um pouco o arquivo <code>calculatr.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">program.version( pkg.version );</div><div class="line">  </div><div class="line">program</div><div class="line">  .command( <span class="string">'sum &lt;number1&gt; &lt;number2&gt;'</span> )</div><div class="line">    .description( <span class="string">'Sum two numbers'</span> )</div><div class="line">    .action(<span class="function"><span class="keyword">function</span> <span class="title">sum</span><span class="params">( number1, number2 )</span> </span>{</div><div class="line">      <span class="built_in">console</span>.log( <span class="built_in">Number</span>( number1 ) + <span class="built_in">Number</span>( number2 ) );</div><div class="line">    });</div><div class="line">  </div><div class="line">program.parse( process.argv );</div></pre></td></tr></table></figure>

<p>Temos três métodos novos do <code>commander</code>: <code>command</code>, <code>description</code> e <code>action</code>. Nós poderíamos ter encadeado todos os métodos, ficando algo como:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">program</div><div class="line">  .version( pkg.version );</div><div class="line">  .command( <span class="string">'sum &lt;number1&gt; &lt;number2&gt;'</span> )</div><div class="line">  .description( <span class="string">'Sum two numbers'</span> )</div><div class="line">  .action(<span class="function"><span class="keyword">function</span> <span class="title">sum</span><span class="params">( number1, number2 )</span> </span>{</div><div class="line">    <span class="built_in">console</span>.log( <span class="built_in">Number</span>( number1 ) + <span class="built_in">Number</span>( number2 ) );</div><div class="line">  })</div><div class="line">  .parse( process.argv );</div></pre></td></tr></table></figure>

<p>Se você achar que assim fica mais legível, fique à vontade :)</p>
<p>Separei pois acho que fica melhor deixar os comandos separados, já que poderemos adicionar mais funcionalidades à nossa ferramenta xD</p>
<p>O <code>command</code> recebe como parâmetro uma string, com o comando, e os argumentos que ele suporta. Quando você usa o parâmetro envolto por <code>&lt;</code> e <code>&gt;</code>, quer dizer que o parâmetro é obrigatório. Para parâmetros opcionais, use <code>[</code> e <code>]</code>.</p>
<p>Depois, o <code>description</code> é uma descrição sobre o comando. Essa descrição é útil quando vocẽ executa no terminal <code>calculatr --help</code>, onde será mostrado o <code>help</code> da sua ferramenta. O <code>commander</code> já deixa toda a interface de retorno do <code>help</code> bonitinha, no padrão da maioria dos <strong>CLIs</strong> em sistemas *nix :D</p>
<p>E a <code>action</code> é a ação para quando o comando for executado no terminal. Essa ação fica em uma função de callback, que recebe como parâmetro os argumentos passados no terminal. O primeiro é o primeiro número, o segundo, o próximo número.</p>
<p>No retorno, executamos um <code>console.log()</code>, para mostrar na saída do terminal, convertendo os dois parâmetros para número com <code>Number()</code> e retornando a soma dos mesmos.</p>
<p>E nosso teste passou \o/</p>
<p>O <code>commander</code> tem vários outros métodos legais. Para saber mais sobre ele, o TJ escreveu um post bem completo, que você pode ler <a href="http://tjholowaychuk.tumblr.com/post/9103188408/commander-js-nodejs-command-line-interfaces-made" target="_blank" rel="external">aqui</a>.</p>
<p><em>E agora, qual o próximo passo?</em></p>
<p>O próximo passo é subir nossa ferramenta no <a href="https://www.npmjs.com/" target="_blank" rel="external">https://www.npmjs.com/</a>!</p>
<h2 id="Subindo_o_módulo_no_NPMJS">Subindo o módulo no NPMJS</h2>
<p>Para subir o módulo é bastante simples: você só precisa executar o comando:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">npm</span> publish</div></pre></td></tr></table></figure>

<p>Mas antes de fazer isso, você precisa ter um cadastro no site do NPM, e configurar sua máquina para poder publicar seus módulos. Vamos ver como fazer isso! </p>
<p>O cadastro é simples: entre em <a href="https://www.npmjs.com/" target="_blank" rel="external">https://www.npmjs.com/</a>, e cadastre-se, como em qualquer outro site xD</p>
<p>Você ainda pode se cadastrar via terminal, com o comando:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm adduser</div></pre></td></tr></table></figure>

<p>Será pedido um nome de usuário, uma senha e um e-mail (que ficará público).</p>
<p>Se você já tinha cadastro no site, só precisa então logar no seu ambiente, com o comando:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm login</div></pre></td></tr></table></figure>

<p>Após isso, vocẽ precisa verificar se os seus dados estão corretamente configurados. Use o comando:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm config ls</div></pre></td></tr></table></figure>

<p>Isso irá listar os seus dados. Confira se tudo está correto.</p>
<p>Mas temos alguns arquivos que não queremos enviar para o NPMJS, como o diretório <code>test</code>, o <code>node_modules</code>, o diretório <code>coverage</code>, criado pelo <code>istanbul</code>.</p>
<p>Para isso, podemos criar um arquivo <code>.npmignore</code> na raiz do nosso projeto, e adicionar esses diretórios, como faríamos no <code>.gitignore</code>.</p>
<p>Feito isso, só executar o comando:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm publish</div></pre></td></tr></table></figure>

<p>E aguardar! Quando o comando terminar de rodar, acesse o <a href="https://www.npmjs.com/package/nome-do-seu-pacote" target="_blank" rel="external">https://www.npmjs.com/package/nome-do-seu-pacote</a> e veja se o seu <strong>CLI</strong> está lá! Pronto, agora você tem uma ferramenta de <strong>CLI</strong> que funciona e está publicada no NPMJS!</p>
<p>Vamos testar se ela funciona? Instale-a globalmente, com o comando:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[<span class="built_in">sudo</span>] npm i -g calculatr</div></pre></td></tr></table></figure>

<p>Coloquei o <code>sudo</code>, pois provavelmente vocẽ irá precisar dele. Tente primeiro instalar sem o <code>sudo</code>. Se não der certo, então use ele.</p>
<p>Agora com nosso módulo instalado, vamos executá-lo para testar, com o comando:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">calculatr sum <span class="number">3</span> <span class="number">4</span></div></pre></td></tr></table></figure>

<p>E o resultado é: <code>7</code>!</p>
<p>Agora tudo pronto :D</p>
<p>Para ver o código completo desse projeto, vocẽ pode acessá-lo no <a href="https://github.com/fdaciuk/calculatr" target="_blank" rel="external">Github</a> ou no <a href="https://www.npmjs.com/package/calculatr" target="_blank" rel="external">NPMJS</a>.</p>
<p>Até a próxima! Dúvidas? Comente :D</p>
<blockquote>
<p>Sobre o #1postperday: <a href="http://blog.da2k.com.br/2014/12/31/um-post-por-dia/" target="_blank" rel="external">http://blog.da2k.com.br/2014/12/31/um-post-por-dia/</a></p>
<p>Tem alguma sugestão para os próximos posts do #1postperday? Deixe ela aqui: <a href="https://github.com/fdaciuk/fdaciuk.github.io/issues/1" target="_blank" rel="external">https://github.com/fdaciuk/fdaciuk.github.io/issues/1</a></p>
</blockquote>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/javascript/">javascript</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/1postperday/">1postperday</a>, <a href="/tags/nodejs/">nodejs</a>, <a href="/tags/cli/">cli</a>
  </div>

        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count" addthis:url="http://blog.da2k.com.br/2015/03/20/criando-uma-ferramenta-de-cli-com-nodejs/"></a>
    
    
      <a class="addthis_button_tweet" addthis:url="http://blog.da2k.com.br/2015/03/20/criando-uma-ferramenta-de-cli-com-nodejs/"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium" addthis:url="http://blog.da2k.com.br/2015/03/20/criando-uma-ferramenta-de-cli-com-nodejs/"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal" addthis:url="http://blog.da2k.com.br/2015/03/20/criando-uma-ferramenta-de-cli-com-nodejs/"></a>
    
    <a class="addthis_counter addthis_pill_style" addthis:url="http://blog.da2k.com.br/2015/03/20/criando-uma-ferramenta-de-cli-com-nodejs/"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>


      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  <div class="newsletter">
  <h3 class="newsletter-title">Não perca nenhuma atualização!</h3>
  <p class="newsletter-description"><em>Não vou mandar SPAM, não se preocupe ;)</em></p>

  <form action="//da2k.us6.list-manage.com/subscribe/post?u=56a51839b0a1d33544ef8745a&amp;id=41446ab989" method="post" target="_blank" data-js="form-newsletter" class="newsletter__form">
    <input type="text" name="FNAME" id="signup-name" placeholder="Nome" class="[ input-text ] newsletter__form__input" />
    <input type="email" name="EMAIL" id="signup-email" placeholder="E-mail" class="[ input-text ] newsletter__form__input" />
    <input type="text" name="b_56a51839b0a1d33544ef8745a_41446ab989" id="signup-email-robot" class="input-robot" />
    <button
      type="submit"
      data-js="button-submit"
      data-loading-text="Enviando..."
      data-original-text="OK"
      class="newsletter__form__button">
      Assinar!
    </button>
  </form>
</div>

  



<section id="comment">
  <h1 class="title">Comments</h1>

  
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
  
</section>


</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action=""
    method="get"
    data-action="https://google.com.br/search?q=site:blog.da2k.com.br"
    accept-charset="utf-8"
    data-js="google-search-form">
    <input type="search" name="q" results="0" placeholder="Search" data-js="google-search-input">
  </form>
</div>


  
<div class="widget tag">
  <h3 class="title">Categories</h3>
  <ul class="entry">
  
    <li><a href="/categories/css/">css</a><small>5</small></li>
  
    <li><a href="/categories/frontend/">frontend</a><small>1</small></li>
  
    <li><a href="/categories/git/">git</a><small>1</small></li>
  
    <li><a href="/categories/github/">github</a><small>13</small></li>
  
    <li><a href="/categories/html/">html</a><small>2</small></li>
  
    <li><a href="/categories/javascript/">javascript</a><small>37</small></li>
  
    <li><a href="/categories/markdown/">markdown</a><small>1</small></li>
  
    <li><a href="/categories/wordpress/">wordpress</a><small>13</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/1postperday/">1postperday</a><small>70</small></li>
  
    <li><a href="/tags/ajax/">ajax</a><small>5</small></li>
  
    <li><a href="/tags/amd/">amd</a><small>2</small></li>
  
    <li><a href="/tags/bdd/">bdd</a><small>1</small></li>
  
    <li><a href="/tags/braches/">braches</a><small>1</small></li>
  
    <li><a href="/tags/chrome-extension/">chrome extension</a><small>1</small></li>
  
    <li><a href="/tags/clean-code/">clean code</a><small>2</small></li>
  
    <li><a href="/tags/cli/">cli</a><small>1</small></li>
  
    <li><a href="/tags/code-coverage/">code coverage</a><small>1</small></li>
  
    <li><a href="/tags/commonjs/">commonjs</a><small>1</small></li>
  
    <li><a href="/tags/coverage/">coverage</a><small>1</small></li>
  
    <li><a href="/tags/debug/">debug</a><small>1</small></li>
  
    <li><a href="/tags/debugger/">debugger</a><small>1</small></li>
  
    <li><a href="/tags/deploy/">deploy</a><small>1</small></li>
  
    <li><a href="/tags/devtools/">devtools</a><small>1</small></li>
  
    <li><a href="/tags/disqus/">disqus</a><small>1</small></li>
  
    <li><a href="/tags/escalabilidade/">escalabilidade</a><small>1</small></li>
  
    <li><a href="/tags/formularios/">formularios</a><small>1</small></li>
  
    <li><a href="/tags/functional-programming/">functional programming</a><small>3</small></li>
  
    <li><a href="/tags/funcoes/">funções</a><small>1</small></li>
  
    <li><a href="/tags/getmodule/">getmodule</a><small>1</small></li>
  
    <li><a href="/tags/git/">git</a><small>1</small></li>
  
    <li><a href="/tags/github/">github</a><small>1</small></li>
  
    <li><a href="/tags/gulpjs/">gulpjs</a><small>5</small></li>
  
    <li><a href="/tags/hexo/">hexo</a><small>1</small></li>
  
    <li><a href="/tags/html5/">html5</a><small>1</small></li>
  
    <li><a href="/tags/istanbul/">istanbul</a><small>1</small></li>
  
    <li><a href="/tags/linux/">linux</a><small>1</small></li>
  
    <li><a href="/tags/markdown/">markdown</a><small>2</small></li>
  
    <li><a href="/tags/module-pattern/">module pattern</a><small>1</small></li>
  
    <li><a href="/tags/mutation-observer/">mutation observer</a><small>1</small></li>
  
    <li><a href="/tags/mvc/">mvc</a><small>1</small></li>
  
    <li><a href="/tags/nodejs/">nodejs</a><small>7</small></li>
  
    <li><a href="/tags/performance/">performance</a><small>1</small></li>
  
    <li><a href="/tags/promises/">promises</a><small>6</small></li>
  
    <li><a href="/tags/pre-processadores/">pré-processadores</a><small>4</small></li>
  
    <li><a href="/tags/recursao/">recursão</a><small>1</small></li>
  
    <li><a href="/tags/requirejs/">requirejs</a><small>1</small></li>
  
    <li><a href="/tags/rsync/">rsync</a><small>1</small></li>
  
    <li><a href="/tags/segredos-do-github/">segredos do github</a><small>12</small></li>
  
    <li><a href="/tags/serie-temas-wordpress/">serie temas wordpress</a><small>11</small></li>
  
    <li><a href="/tags/setinterval/">setInterval</a><small>1</small></li>
  
    <li><a href="/tags/settimeout/">setTimeout</a><small>1</small></li>
  
    <li><a href="/tags/sourcemaps/">sourcemaps</a><small>1</small></li>
  
    <li><a href="/tags/spam/">spam</a><small>1</small></li>
  
    <li><a href="/tags/ssh/">ssh</a><small>1</small></li>
  
    <li><a href="/tags/stylus/">stylus</a><small>4</small></li>
  
    <li><a href="/tags/task-runner/">task runner</a><small>1</small></li>
  
    <li><a href="/tags/tdd/">tdd</a><small>2</small></li>
  
    <li><a href="/tags/tema-wordpress/">tema wordpress</a><small>1</small></li>
  
    <li><a href="/tags/temporizadores/">temporizadores</a><small>1</small></li>
  
    <li><a href="/tags/tips/">tips</a><small>5</small></li>
  
    <li><a href="/tags/umd/">umd</a><small>1</small></li>
  
    <li><a href="/tags/void/">void</a><small>1</small></li>
  
    <li><a href="/tags/wordcamp/">wordcamp</a><small>1</small></li>
  
    <li><a href="/tags/workflow/">workflow</a><small>3</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2015 <a href="//plus.google.com/+FernandoDaciuk?rel=author" rel="author"  target="_blank">Fernando Daciuk</a>
  
</div>
<div class="clearfix"></div>
</footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/google-search.js"></script>
<script src="/js/modules/InfiniteScroll.js"></script>
<script src="/js/app.js" id="script-main" data-url="http://blog.da2k.com.br/2015/03/20/criando-uma-ferramenta-de-cli-com-nodejs/"></script>


<script type="text/javascript">
var disqus_shortname = 'blogda2k';
var disqus_url = 'http://blog.da2k.com.br/2015/03/20/criando-uma-ferramenta-de-cli-com-nodejs/';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


</body>
</html>